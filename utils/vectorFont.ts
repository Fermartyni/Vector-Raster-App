import { VectorShape } from '../types';

// Simple 3x5 grid font definitions (normalized 0-1)
const CHAR_MAP: Record<string, number[][][]> = {
  'A': [[[0, 1], [0.5, 0], [1, 1]], [[0.2, 0.6], [0.8, 0.6]]],
  'B': [[[0, 1], [0, 0], [0.7, 0], [0.8, 0.2], [0.7, 0.5], [0, 0.5], [0.7, 0.5], [0.8, 0.8], [0.7, 1], [0, 1]]],
  'C': [[[1, 0.2], [0.8, 0], [0.2, 0], [0, 0.2], [0, 0.8], [0.2, 1], [0.8, 1], [1, 0.8]]],
  'D': [[[0, 1], [0, 0], [0.7, 0], [1, 0.3], [1, 0.7], [0.7, 1], [0, 1]]],
  'E': [[[1, 0], [0, 0], [0, 1], [1, 1]], [[0, 0.5], [0.8, 0.5]]],
  'F': [[[1, 0], [0, 0], [0, 1]], [[0, 0.5], [0.8, 0.5]]],
  'G': [[[1, 0.2], [0.8, 0], [0.2, 0], [0, 0.2], [0, 0.8], [0.2, 1], [0.8, 1], [1, 0.8], [1, 0.5], [0.5, 0.5]]],
  'H': [[[0, 0], [0, 1]], [[1, 0], [1, 1]], [[0, 0.5], [1, 0.5]]],
  'I': [[[0.5, 0], [0.5, 1]], [[0, 0], [1, 0]], [[0, 1], [1, 1]]],
  'J': [[[0.8, 0], [0.8, 0.8], [0.6, 1], [0.2, 1], [0, 0.8]]],
  'K': [[[0, 0], [0, 1]], [[1, 0], [0, 0.5], [1, 1]]],
  'L': [[[0, 0], [0, 1], [1, 1]]],
  'M': [[[0, 1], [0, 0], [0.5, 0.5], [1, 0], [1, 1]]],
  'N': [[[0, 1], [0, 0], [1, 1], [1, 0]]],
  'O': [[[0, 0], [1, 0], [1, 1], [0, 1], [0, 0]]],
  'P': [[[0, 1], [0, 0], [1, 0], [1, 0.5], [0, 0.5]]],
  'Q': [[[0, 0], [1, 0], [1, 1], [0, 1], [0, 0]], [[0.6, 0.6], [1, 1]]],
  'R': [[[0, 1], [0, 0], [1, 0], [1, 0.5], [0, 0.5], [1, 1]]],
  'S': [[[1, 0.2], [0.8, 0], [0.2, 0], [0, 0.2], [0.8, 0.8], [1, 0.8], [0.8, 1], [0.2, 1], [0, 0.8]]],
  'T': [[[0.5, 0], [0.5, 1]], [[0, 0], [1, 0]]],
  'U': [[[0, 0], [0, 0.8], [0.2, 1], [0.8, 1], [1, 0.8], [1, 0]]],
  'V': [[[0, 0], [0.5, 1], [1, 0]]],
  'W': [[[0, 0], [0.2, 1], [0.5, 0.5], [0.8, 1], [1, 0]]],
  'X': [[[0, 0], [1, 1]], [[1, 0], [0, 1]]],
  'Y': [[[0, 0], [0.5, 0.5]], [[1, 0], [0.5, 0.5], [0.5, 1]]],
  'Z': [[[0, 0], [1, 0], [0, 1], [1, 1]]],
  '0': [[[0, 0], [1, 0], [1, 1], [0, 1], [0, 0], [1, 1]]],
  '1': [[[0.2, 0], [0.5, 0], [0.5, 1], [0.2, 1], [0.8, 1]]],
  '2': [[[0, 0.2], [0.2, 0], [0.8, 0], [1, 0.2], [1, 0.5], [0, 1], [1, 1]]],
  '3': [[[0, 0], [1, 0], [0.5, 0.5], [1, 0.5], [1, 1], [0, 1]]],
  '4': [[[0.8, 1], [0.8, 0]], [[0, 0.5], [0.8, 0.5], [0.6, 0]]],
  '5': [[[1, 0], [0, 0], [0, 0.4], [0.8, 0.4], [1, 0.6], [1, 0.8], [0.8, 1], [0, 1]]],
  '6': [[[1, 0], [0.2, 0.2], [0, 0.5], [0, 0.8], [0.2, 1], [0.8, 1], [1, 0.8], [1, 0.5], [0, 0.5]]],
  '7': [[[0, 0], [1, 0], [0.4, 1]]],
  '8': [[[0.5, 0.5], [0.2, 0.2], [0.5, 0], [0.8, 0.2], [0.5, 0.5], [0.8, 0.8], [0.5, 1], [0.2, 0.8], [0.5, 0.5]]],
  '9': [[[1, 0.5], [0, 0.5], [0.2, 0.2], [0.8, 0.2], [1, 0.5], [0.8, 0.8], [0, 1]]],
  ' ': [],
  '.': [[[0.4, 0.9], [0.6, 0.9], [0.6, 1], [0.4, 1], [0.4, 0.9]]],
  '-': [[[0.2, 0.5], [0.8, 0.5]]],
  '?': [[[0, 0.2], [0.2, 0], [0.8, 0], [1, 0.2], [1, 0.4], [0.5, 0.6], [0.5, 0.8]], [[0.5, 0.95], [0.5, 1]]]
};

export const textToVectorShapes = (text: string, startX: number, startY: number, scale: number): VectorShape[] => {
  const shapes: VectorShape[] = [];
  const upperText = text.toUpperCase();
  const spacing = 1.5 * scale;
  
  let currentX = startX;
  let currentY = startY;
  const maxCharsPerLine = 8; // simple wrap
  let charCount = 0;

  for (let i = 0; i < upperText.length; i++) {
    const char = upperText[i];
    
    if (charCount >= maxCharsPerLine) {
        currentX = startX;
        currentY += spacing * 1.5;
        charCount = 0;
    }

    const strokes = CHAR_MAP[char] || [];
    
    strokes.forEach((stroke, sIdx) => {
      const points = stroke.map(p => ({
        x: currentX + p[0] * scale,
        y: currentY + p[1] * scale
      }));

      shapes.push({
        id: `char-${i}-${sIdx}`,
        points,
        closed: false
      });
    });

    currentX += spacing;
    charCount++;
  }
  
  return shapes;
};